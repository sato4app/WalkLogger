# gWalkLogger 機能仕様書

## 概要

gWalkLoggerは、GPS位置情報を取得・記録し、GPXファイルとして出力できるProgressive Web Application (PWA)です。ウォーキングやハイキング等のアウトドア活動での軌跡記録を目的とした、シンプルで使いやすいツールです。

## 基本機能

### 1. GPS位置情報取得・記録機能

#### 1.1 位置情報取得設定
- **取得精度**: 高精度位置情報を有効化（enableHighAccuracy: true）
- **タイムアウト**: 10秒でタイムアウト
- **キャッシュ**: 最新データを取得（maximumAge: 0）
- **取得間隔**: 3秒間隔で自動取得

#### 1.2 取得データ項目
- 緯度（latitude）：6桁精度で表示
- 経度（longitude）：6桁精度で表示  
- 標高（altitude）：取得可能時は2桁精度で表示、取得不可時は「N/A」
- 取得日時：日本語形式（YYYY/MM/DD HH:MM:SS）で表示

#### 1.3 表示形式
- 緯度：北緯/南緯の表記で表示
- 経度：東経/西経の表記で表示
- グリッドレイアウトでラベルと値を整理して表示

### 2. 操作・制御機能

#### 2.1 計測制御
- **開始ボタン**: 計測開始、押下時に無効化
- **終了ボタン**: 計測終了、計測中のみ有効化
- **チェックボックス**: GPX出力の有効/無効切り替え（デフォルト：有効）

#### 2.2 計測フロー
1. 計測開始時：データ配列リセット、画面クリア、即座に1回目の位置取得
2. 計測中：3秒間隔での自動取得、リアルタイム表示更新
3. 計測終了時：自動取得停止、GPX出力（チェックボックス有効時）

### 3. GPXファイル出力機能

#### 3.1 ファイル命名規則
- **形式**: `YYYYMMDD-NNN.gpx`
- **例**: `20240803-001.gpx`
- **連番管理**: 日付ごとにlocalStorageで自動採番（001〜999）

#### 3.2 GPXデータ構造
- **準拠**: GPX 1.1標準形式
- **トラックポイント**: 緯度、経度、標高（取得時）、タイムスタンプ
- **メタデータ**: トラック名、開始時刻
- **エンコーディング**: UTF-8

#### 3.3 出力仕様
- **トリガー**: 計測終了時、GPX出力チェックボックス有効時
- **配信方法**: ブラウザダウンロード機能使用
- **ファイル形式**: .gpx（XMLベース）

### 4. ユーザーインターフェース

#### 4.1 レイアウト構成
- **ヘッダー**: アプリタイトル「GPS Logger」
- **メインエリア**: ログ表示エリア（スクロール対応）
- **フッター**: GPX出力オプション、開始/終了ボタン

#### 4.2 レスポンシブデザイン
- **モバイルファースト**: スマートフォンでの使用を前提
- **安全エリア対応**: iPhone等のノッチ部分を考慮
- **タッチ操作**: タッチデバイスでの操作性を最適化

#### 4.3 視覚的フィードバック
- **ボタン状態**: 無効状態のグレーアウト
- **ログ表示**: 情報/エラーメッセージの色分け
- **スクロール**: 新規ログ追加時の自動スクロール

### 5. PWA（Progressive Web App）機能

#### 5.1 インストール対応
- **マニフェスト**: manifest.jsonでアプリ情報定義
- **アイコン**: 192×192pxアイコン設定
- **ホーム画面**: 追加可能な独立アプリとして動作

#### 5.2 Service Worker
- **オフライン対応**: キャッシュ戦略によるオフライン動作
- **アップデート**: 自動アップデート機能

#### 5.3 モバイルブラウザ最適化
- **iOS Safari対応**: apple-mobile-web-app設定
- **ビューポート**: ユーザースケール無効化
- **ステータスバー**: 半透明設定

### 6. エラーハンドリング

#### 6.1 位置情報エラー
- **権限拒否**: エラーコードとメッセージ表示
- **タイムアウト**: 10秒でタイムアウト処理
- **精度不足**: 高精度取得失敗時の代替処理

#### 6.2 ブラウザ対応エラー
- **位置情報API未対応**: 非対応ブラウザでの警告表示
- **Service Worker未対応**: PWA機能制限の通知

### 7. データ管理

#### 7.1 一時データ保存
- **メモリ保存**: 計測中のGPSデータ配列（gpsDataPoints）
- **セッション管理**: 計測開始/終了でのデータリセット

#### 7.2 永続データ
- **localStorage**: GPXファイル連番管理のみ
- **プライバシー**: 位置データの永続保存なし

### 8. 技術仕様

#### 8.1 使用技術
- **フロントエンド**: Vanilla JavaScript (ES6+)
- **CSS**: Flexbox、Grid Layout、CSS変数
- **API**: Geolocation API、File Download API、Service Worker API

#### 8.2 ブラウザ要件
- **位置情報API**: navigator.geolocation必須
- **Service Worker**: PWA機能用（オプション）
- **モダンブラウザ**: ES6対応ブラウザ

#### 8.3 ファイル構成
- `index.html`: メインHTML（36行）
- `script.js`: アプリケーションロジック（154行）
- `style.css`: スタイル定義（134行）
- `manifest.json`: PWA設定
- `service-worker.js`: オフライン対応

## 使用シナリオ

### 基本的な使用フロー
1. アプリ起動・位置情報許可
2. 「開始」ボタン押下で計測開始
3. リアルタイムでGPS情報表示確認
4. 「終了」ボタン押下で計測終了
5. GPXファイル自動ダウンロード
6. ファイルを他アプリで活用（地図アプリ等）

### 想定用途
- ウォーキング・ジョギングコース記録
- ハイキング・登山ルート記録
- サイクリングコース記録
- 散歩・観光ルート記録